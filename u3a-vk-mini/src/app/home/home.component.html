<div class="home-container">
  <!-- –•–µ–¥–µ—Ä -->
  <header class="header">
    <div class="header-row">
      @if (user(); as currentUser) {
        <div class="user-info">
          @if (currentUser.photo_200) {
            <img [src]="currentUser.photo_200" [alt]="currentUser.first_name" class="user-avatar">
          } @else {
            <div class="user-avatar-placeholder">
              {{ currentUser.first_name.charAt(0) }}{{ currentUser.last_name.charAt(0) }}
            </div>
          }
          <div class="user-name-wrap">
            <div class="user-fullname">{{ currentUser.first_name }} {{ currentUser.last_name }}</div>
            <div class="user-username">&#64;{{ getUserName() }}</div>
          </div>
        </div>
      } @else {
        <div class="user-info">
          <div class="user-avatar-placeholder">U3</div>
          <div class="user-name-wrap">
            <div class="user-fullname">–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞</div>
            <div class="user-username">&#64;guest</div>
          </div>
        </div>
      }
    </div>

  </header>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="main-content">
    <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫—É—Ä—Å—É</h2>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫—É—Ä—Å–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ª–∏—Å—Ç–∞–Ω–∏—è -->
    <div class="stats-cards-container">
      <div class="stats-cards-wrapper">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫—É—Ä—Å–æ–≤ -->
        @for (card of courseCards(); track card.courseId; let i = $index) {
          <section class="stats-card" [class.active]="currentCardIndex === i" [class.hidden]="currentCardIndex !== i">
            <div class="stats-title">{{ card.course?.title || '–ö—É—Ä—Å' }}</div>

            <div class="progress-row">
              <div class="progress-label">–ü—Ä–æ–π–¥–µ–Ω–æ –ª–µ–∫—Ü–∏–π</div>
              <div class="progress-value">{{ card.progress }}%</div>
            </div>
            <div class="progress">
              <div class="progress-track"></div>
              <div class="progress-fill" [style.width.%]="card.progress"></div>
            </div>

            <div class="progress-row">
              <div class="progress-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
              <div class="progress-value">{{ card.score }}%</div>
            </div>
            <div class="progress">
              <div class="progress-track"></div>
              <div class="progress-fill success" [style.width.%]="card.score"></div>
            </div>

            <button class="primary-button btn-blue" (click)="openCourse(card.course!)">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫—É—Ä—Å—É</button>
          </section>
        }

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" -->
        <section class="stats-card more-card" [class.active]="currentCardIndex === courseCards().length" [class.hidden]="currentCardIndex !== courseCards().length">
          <div class="more-card-content">
            <div class="more-icon">üìä</div>
            <div class="more-title">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="more-description">–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –∫—É—Ä—Å–∞–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
            <button class="primary-button btn-blue" (click)="onNavigateToProgress()">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          </div>
        </section>
      </div>

      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º -->
      @if (getTotalCards() > 1) {
        <div class="cards-navigation">
          <button class="nav-button prev" (click)="prevCard()" [disabled]="currentCardIndex === 0">‚Äπ</button>
          <div class="cards-indicators">
            @for (i of [].constructor(getTotalCards()); track i; let index = $index) {
              <div class="indicator" [class.active]="currentCardIndex === index"></div>
            }
          </div>
          <button class="nav-button next" (click)="nextCard()" [disabled]="currentCardIndex >= getTotalCards() - 1">‚Ä∫</button>
        </div>
      }
    </div>

    <h2 class="section-title">–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ</h2>

    <div class="courses-list">
      @for (course of inProgressCourses(); track course.id) {
        <article class="course-card" (click)="openCourse(course)">
          <div class="course-cover"></div>
          <div class="course-info">
            <div class="course-title">{{ course.title }}</div>
            <div class="course-meta">–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
          </div>
          <div class="fav-mark" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" [class.favorited]="isFav(course)">
            <svg class="fav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </div>
        </article>
      }
      @empty {
        <p class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—á–∞—Ç—ã—Ö –∫—É—Ä—Å–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ö—É—Ä—Å—ã¬ª.</p>
      }
    </div>
  </main>

  <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <app-bottom-nav active="home" />

  <!-- –°—Ç–∞—Ç—É—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
  @if (!isInitialized()) {
    <div class="loading-overlay">
      <div class="loading-spinner"></div>
      <p>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</p>
    </div>
  }
</div>
